<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Player Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Entre ton pseudo</h2>
  <input id="pseudoInput" placeholder="Ton nom" />
  <button id="startBtn">Commencer</button>

  <div id="waitingScreen" style="display: none; margin: 20px;">
    <h2>ðŸ‘€ Tiens-toi prÃªt, le quiz va bientÃ´t commencer !</h2>
  </div>

  <div id="quiz" style="display:none;">
    <div id="waiting" style="margin:20px;"></div>
    <div id="colorButtons"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const pseudoInput = document.getElementById('pseudoInput');
    const startBtn = document.getElementById('startBtn');
    const quiz = document.getElementById('quiz');
    const waiting = document.getElementById('waiting');
    const colorButtons = document.getElementById('colorButtons');
    const waitingScreen = document.getElementById('waitingScreen');

    let couleurs = ['c0', 'c1', 'c2', 'c3'];
    let ready = false;

    startBtn.addEventListener('click', () => {
      const pseudo = pseudoInput.value.trim();
      if (pseudo) {
        socket.emit('pseudo', pseudo);
        document.querySelector('h2').style.display = 'none';
        pseudoInput.style.display = 'none';
        startBtn.style.display = 'none';
        waitingScreen.style.display = 'block';
        ready = true;
      }
    });

    socket.on('question', (q) => {
      if (!ready) return;
      waitingScreen.style.display = 'none';
      quiz.style.display = 'block';
      waiting.textContent = "Choisis une couleur :";
      colorButtons.innerHTML = '';
      q.reponses.forEach((_, i) => {
        const btn = document.createElement('button');
        btn.className = `color-button ${couleurs[i]}`;
        btn.onclick = () => socket.emit('answer', i);
        colorButtons.appendChild(btn);
      });
    });

    socket.on('waiting', () => {
      if (!ready) return;
      waiting.textContent = "ðŸ•’ En attente des autres joueurs...";
      colorButtons.innerHTML = '';
    });

    socket.on('quizEnd', (classement) => {
      if (!ready) return;
      waiting.textContent = "âœ… Quiz terminÃ© !";
      colorButtons.innerHTML = '<h3>Classement final :</h3><ol>' +
        classement.map(p => `<li>${p.pseudo} â€“ ${p.score} pts</li>`).join('') +
        '</ol>';
    });
  </script>
</body>
</html>
